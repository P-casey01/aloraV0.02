{% extends "base.html" %}

{% block title %}Login{% endblock %}

{% block content %}


<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <title>Alora-Ai</title>
        
        <link rel="stylesheet" type="text/css" href="static/css/chatbot-style.css">
       
        <script>
        function showLoadingScreen() {
    document.getElementById('loading-overlay').style.display = 'flex';
}

let currentQuestion = 0;
const questions = [
    'question1',
    'question2',
    'question3',
    'question4',
    'question5',
    'question6',
    'question7',
    'question8',
    'question9',
];


const inputIds = [
    'goals',
    'food-preferences',
    'dietary-restrictions',
    'age',
    'gender',
    'height',
    'weight',
    'time',
    'activity-level',
];

// Typewriter effect
function typeWriter(elementId, text, elementsToDisplay, index = 0, callback) {
    if (index < text.length) {
        document.getElementById(elementId).innerHTML += text.charAt(index);
        setTimeout(() => typeWriter(elementId, text, elementsToDisplay, index + 1, callback), 50);
    } else {
        if (callback) {
            callback();
        }
        if (elementsToDisplay) {
            elementsToDisplay.forEach(element => {
                if (element) {
                    element.style.display = 'block';
                }
            });
            const inputElement = document.querySelector(`#${elementId.split('-')[0]} input, #${elementId.split('-')[0]} select`);
            if (inputElement) {
                inputElement.style.display = 'block';
            }
        }
    }
}

// Update the input field based on the current question
function updateInputField(questionNumber) {
    const inputLabel = document.getElementById('input-label');
    const inputText = document.querySelector('#input-container input[type=text]');
    const inputSelect = document.getElementById('input-select');

    inputText.style.display = 'none';
    inputSelect.style.display = 'none';

    if (questionNumber === 5) { // Gender question
        inputLabel.textContent = 'I am:';
        inputSelect.style.display = 'block';
    } else {
        inputLabel.textContent = [
            'My goals are:',
            'I enjoy eating:',
            "I can't eat:",
            'I am:',
            'I am:', // Gender question, but we're using select for it
            'I am:',
            'I weigh:',
            'I would like to spend this long cooking meals:',
            'My activity level is:'
        ][questionNumber - 1];

        inputText.style.display = 'block';
        inputText.value = ''; // Clear the input value
    }
}

// Show the current question
function showQuestion(questionId) {
    if (currentQuestion > 1) {
        const prevQuestionId = questions[currentQuestion - 2];
        const prevInputElement = document.querySelector(`#${prevQuestionId} input, #${prevQuestionId} select`);
        if (prevInputElement) {
            prevInputElement.style.display = 'none';
        }
    }

    document.getElementById(questionId).style.display = 'block';
    document.getElementById(`${questionId}-text`).innerHTML = '';
    typeWriter(`${questionId}-text`, document.getElementById(`${questionId}-text`).getAttribute('data-text'), [document.querySelector(`#${questionId} label`)], 0);
    updateInputField(currentQuestion); // moved this line
}


// Hide the current question
function hideQuestion(questionId) {
    document.getElementById(questionId).style.display = 'none';
}

// Validate the answer
function handleAnswer(questionId) {
    const inputElement = document.querySelector(`#${questionId} input, #${questionId} select`);

    if (inputElement && inputElement.style.display !== 'none') {
        if (inputElement.value.trim() !== '') {
            return true;
        } else {
            alert('Please answer the question before proceeding.');
            return false;
        }
    }
    return true;
}
// Handle the next button click
function nextButtonClick() {
    if (!handleAnswer(questions[currentQuestion - 1])) {
        return;
    }

    let userInput = document.getElementById("user-input");
    let inputSelect = document.getElementById("input-select");
    let inputElement;

    if (currentQuestion === 5) { // Gender question
        inputElement = inputSelect;
    } else {
        inputElement = userInput;
    }

    // Save the user input to the corresponding inputIds array element
    document.getElementById(inputIds[currentQuestion - 1]).value = inputElement.value;

    hideQuestion(questions[currentQuestion - 1]); // Hide the previous question

    currentQuestion++;

    if (currentQuestion >= questions.length) {
        document.getElementById("submit-button").style.display = "block";
    } else {
        document.getElementById("submit-button").style.display = "none";
    }

    showQuestion(questions[currentQuestion - 1]);
}
function prevButtonClick() {
    if (currentQuestion > 0) {
        let userInput = document.getElementById("user-input");
        let inputSelect = document.getElementById("input-select");
        let inputElement;

        hideQuestion(questions[currentQuestion - 1]); // Hide the current question

        currentQuestion--;

        if (currentQuestion === 4) {
            inputElement = inputSelect;
        } else {
            inputElement = userInput;
        }

        // Load the saved value from the inputIds array element for the current question
        inputElement.value = document.getElementById(inputIds[currentQuestion - 1]).value;
        showQuestion(questions[currentQuestion - 1]);
    }
}
function convertHeightToCm() {
    var feet = document.getElementById("feet").value;
    var inches = document.getElementById("inches").value;
    var totalInches = feet * 12 + parseInt(inches);
    var heightInCm = totalInches * 2.54;
    document.getElementById("heightField").value = heightInCm.toFixed(2);
}

function convertWeightToKg() {
    var pounds = document.getElementById("pounds").value;
    var weightInKg = pounds * 0.45359237;
    document.getElementById("weightField").value = weightInKg.toFixed(2);
}

function showHeightConverter() {
    document.getElementById("heightConverter").style.display = "block";
}

function hideHeightConverter() {
    document.getElementById("heightConverter").style.display = "none";
}

function showWeightConverter() {
    document.getElementById("weightConverter").style.display = "block";
}

function hideWeightConverter() {
    document.getElementById("weightConverter").style.display = "none";
}
window.onload = function() {
    document.getElementById("height").addEventListener('focus', showHeightConverter);
    document.getElementById("height").addEventListener('blur', hideHeightConverter);
    document.getElementById("weight").addEventListener('focus', showWeightConverter);
    document.getElementById("weight").addEventListener('blur', hideWeightConverter);
    // Rest of your code...
}

// Submit the form
function submitForm() {
    if (handleAnswer()) {
        showLoadingScreen();
        setTimeout(() => {
            document.querySelector('form').submit();
        }, 1000);
    }
}

// Show the first question on window load
window.onload = () => {
    showQuestion(questions[0]);
    currentQuestion++;
};
        </script>
    </head>
    <body>
        <form action="/resultstable.html" method="POST">
            <div class="chat-container">
                <div class="chat-bubble bot" id="question1" style="display: none;">
                    <h1>Alora-ai</h1>
                    <p id="question1-text" data-text="Hi there! My names Alora. In order to get started im going to have to ask a few questions. Let's start with your goals. Please try to be as specific as posible it helps improve results :)"></p>
                
                </div>
                <div class="chat-bubble bot" id="question2" style="display: none;">
                    <p id="question2-text" data-text="What type of food do you enjoy? Do you have any favorite cuisines or dishes?"></p>
                    
                </div>
                <div class="chat-bubble bot" id="question3" style="display: none;">
                    <p id="question3-text" data-text="Do you have any dietary restrictions or allergies that we should know about?"></p>
                    
                </div>
                <div class="chat-bubble bot" id="question4" style="display: none;">
                    <p id="question4-text" data-text="May I ask how old you are? This information is important in estimating your caloric needs."></p>
                    
                </div>
                <div class="chat-bubble bot" id="question5" style="display: none;">
                    <p id="question5-text" data-text="What is your gender?"></p>
                </div>
        
                <div class="chat-bubble bot" id="question6" style="display: none;">
                    <p id="question6-text" data-text="How tall are you?"></p>
                    
                </div>
        
                <div class="chat-bubble bot" id="question7" style="display: none;">
                    <p id="question7-text" data-text="And how much do you weigh?"></p>
                    
                </div>
        
                <div class="chat-bubble bot" id="question8" style="display: none;">
                    <p id="question8-text" data-text="How much time would you like to spend cooking each meal?"></p>
                    
                </div>
        
                <div class="chat-bubble bot" id="question9" style="display: none;">
                    <p id="question9-text" data-text="Finally, can you tell me a bit about your activity level? This includes both exercise and non-exercise physical activity, such as walking, standing, and fidgeting."></p>
                    
                </div>
            </div>
            <input type="hidden" id="goals" name="goals">
            <input type="hidden" id="food-preferences" name="food-preferences">
            <input type="hidden" id="dietary-restrictions" name="dietary-restrictions">
            <input type="hidden" id="age" name="age">
            <input type="hidden" id="gender" name="gender">
            <input type="hidden" id="height" name="height">
            <input type="hidden" id="weight" name="weight">
            <input type="hidden" id="time" name="time">
            <input type="hidden" id="activity-level" name="activity-level">
            
            <div class="user-input-container" id="input-container">
                <label for="user-input" id="input-label"></label>
                <input type="text" id="user-input" name="user-input" class="input-box bottom-input">
            
                <div id="heightConverter" style="display: none;">
                    <label for="feet">Feet</label>
                    <input type="text" class="form-control" id="feet" oninput="convertHeightToCm()">
                    <label for="inches">Inches</label>
                    <input type="text" class="form-control" id="inches" oninput="convertHeightToCm()">
                </div>
            
                <div id="weightConverter" style="display: none;">
                    <label for="pounds">Pounds</label>
                    <input type="text" class="form-control" id="pounds" oninput="convertWeightToKg()">
                </div>
            
                <select id="input-select" class="input-box bottom-input" name="gender" style="display: none;">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            
                <div class="question-buttons">
                    <input type="button" value="Previous" onclick="prevButtonClick()">
                    <input type="button" value="Next" onclick="nextButtonClick()">
                    <!-- Add a submit button -->
                    <input type="submit" value="Submit" id="submit-button" style="display: none;">
                </div>
            </div>
            
            </form>
            <div id="loading-overlay" style="display: none;">
                <div class="loading-container">
                    <div class="infinity-spinner">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                    <p>Loading, please wait...</p>
                </div>
            </div>
            {% endblock %}